

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YOLO Object Detection + Captioning</title>
  <style>
    :root {
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa7bf;
      --accent:#7c3aed;
      --glass: rgba(255,255,255,0.03);
      --green:#10b981;
      --danger:#ef4444;
      font-family: Inter, system-ui, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(180deg,#071025 0%, #0b1630 100%);
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .wrap{
      width:100%;
      max-width:980px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;
      padding:22px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.7);
      border:1px solid rgba(255,255,255,0.03);
    }
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;}
    .title{display:flex;gap:12px;align-items:center;}
    .logo{
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(135deg,var(--accent),#3b82f6);
      display:flex;align-items:center;justify-content:center;
      font-weight:700;font-size:20px;color:white;
      box-shadow:0 6px 18px rgba(124,58,237,0.18);
    }
    h1{margin:0;font-size:18px}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:340px 1fr;gap:18px;margin-top:16px;}
    .card{background:var(--card);padding:16px;border-radius:12px;border:1px solid var(--glass);}
    .uploader{display:flex;flex-direction:column;gap:12px;}
    .image-preview{
      width:100%;height:220px;background:rgba(255,255,255,0.02);
      border-radius:8px;display:flex;align-items:center;justify-content:center;
      overflow:hidden;border:1px dashed rgba(255,255,255,0.05);position:relative;
    }
    .image-preview img{max-width:100%;max-height:100%;display:block}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{
      background:linear-gradient(180deg,var(--accent),#4f46e5);
      color:white;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;
      font-weight:600;box-shadow:0 6px 18px rgba(79,70,229,0.12);
    }
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--muted)}
    input[type="file"]{display:none}
    .small{font-size:13px;color:var(--muted)}
    .progress{height:12px;border-radius:8px;background:rgba(255,255,255,0.05);overflow:hidden}
    .progress>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#34d399,#60a5fa);transition:width .4s linear}
    .status{font-size:13px;color:var(--muted);margin-top:6px}
    .canvas-wrap{display:flex;flex-direction:column;gap:12px}
    canvas{border-radius:8px;border:1px solid rgba(255,255,255,0.05);background:#071022;max-width:100%}
    .results{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
    .chip{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:999px;font-weight:600;font-size:13px}
    .caption{
      margin-top:8px;padding:12px;border-radius:10px;
      background:linear-gradient(180deg, rgba(124,58,237,0.06), rgba(255,255,255,0.02));
      border:1px solid rgba(124,58,237,0.06);
      color:#dfe9ff;font-size:15px;
    }
    footer{margin-top:12px;font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    .legend{display:flex;gap:8px;flex-wrap:wrap}
    .legend .item{display:flex;gap:6px;align-items:center;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02)}
    .color-dot{width:12px;height:12px;border-radius:3px}
    @media (max-width:880px){.grid{grid-template-columns:1fr}.image-preview{height:200px}}
  </style>
</head>

<body>
  <main class="wrap" role="main">
    <!-- Back to Home Button -->
<div style="text-align:left; margin-bottom:20px;">
  <a href="/" style="
      display:inline-block;
      padding:10px 16px;
      background:linear-gradient(180deg,#7c3aed,#4f46e5);
      color:white;
      border-radius:8px;
      font-weight:600;
      text-decoration:none;
      transition:0.3s;">
    ← Back to Home
  </a>
</div>

    <header>
      <div class="title">
        <div class="logo">YOLO</div>
        <div>
          <h1>YOLO Object Detection + Captioning</h1>
          <p class="lead">Upload an image to detect objects and generate captions.</p>
        </div>
      </div>
    </header>

    <section class="grid">
      <div class="card">
        <div class="uploader">
          <strong>Welcome!</strong>
          <div class="small">Choose an image to begin.</div>

          <div class="image-preview" id="imagePreview">
            <span id="noImageText" class="small">No image selected</span>
            <img id="previewImg" alt="" style="display:none" />
          </div>

          <div class="controls">
            <input id="fileInput" type="file" accept="image/*" />
            <label for="fileInput" class="btn ghost">Choose Image</label>
            <button id="startBtn" class="btn" disabled>Start Detection</button>
            <button id="resetBtn" class="btn ghost">Reset</button>
          </div>

          <div>
            <div class="small">Processing progress</div>
            <div class="progress"><i id="progressBar"></i></div>
            <div class="status" id="statusText">Waiting for image...</div>
          </div>
        </div>
      </div>

      <div class="card canvas-wrap">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="small">Detected Image</div>
          <div class="legend" id="legend"></div>
        </div>

        <canvas id="mainCanvas" width="800" height="500"></canvas>

        <div class="results">
          <div class="chip" id="numObjects">Objects: 0</div>
          <div class="chip" id="confidenceAvg">Avg Conf: —</div>
          <div style="margin-left:auto;display:flex;gap:8px">
            <button id="ttsBtn" class="btn" disabled>Hear Caption</button>
            <button id="downloadBtn" class="btn ghost" disabled>Download</button>
          </div>
        </div>

        <div class="caption" id="captionArea">Caption will appear here.</div>

        <footer>
          <div>Made by <strong>Sonal Raikar</strong>, <strong>Siddhali Kathar</strong> & <strong>Chaitali Bhamre</strong></div>
        </footer>
      </div>
    </section>
  </main>

  <script>
    const fileInput = document.getElementById('fileInput');
    const previewImg = document.getElementById('previewImg');
    const noImageText = document.getElementById('noImageText');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const progressBar = document.getElementById('progressBar');
    const statusText = document.getElementById('statusText');
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const numObjectsChip = document.getElementById('numObjects');
    const confidenceAvgChip = document.getElementById('confidenceAvg');
    const captionArea = document.getElementById('captionArea');
    const ttsBtn = document.getElementById('ttsBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const legend = document.getElementById('legend');

    let loadedImage = null;
    let currentDetections = null;
    const labelColors = {};

    function colorForLabel(label){
      if(labelColors[label]) return labelColors[label];
      const palette = ['#ef4444','#10b981','#3b82f6','#f59e0b','#a855f7','#ec4899','#14b8a6'];
      const c = palette[Object.keys(labelColors).length % palette.length];
      labelColors[label] = c; return c;
    }

    function fitCanvas(img){
      const maxW=820,maxH=560;
      let w=img.naturalWidth,h=img.naturalHeight;
      const r=Math.min(maxW/w,maxH/h,1);
      canvas.width=w*r;canvas.height=h*r;
    }

    function drawDetections(img,det){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      legend.innerHTML='';

      if(!det||!det.boxes)return;
      ctx.lineWidth=2;
      ctx.font='14px Inter';
      det.boxes.forEach(b=>{
        const c=colorForLabel(b.label);
        const isRel=b.x<=1&&b.y<=1&&b.w<=1&&b.h<=1;
        const x=isRel?b.x*canvas.width:b.x;
        const y=isRel?b.y*canvas.height:b.y;
        const w=isRel?b.w*canvas.width:b.w;
        const h=isRel?b.h*canvas.height:b.h;
        ctx.strokeStyle=c;
        ctx.strokeRect(x,y,w,h);
        ctx.fillStyle=c;
        ctx.globalAlpha=0.8;
        ctx.fillRect(x,y-20,ctx.measureText(b.label).width+40,20);
        ctx.globalAlpha=1;
        ctx.fillStyle='#041224';
        ctx.fillText(`${b.label} ${(b.score*100).toFixed(0)}%`,x+4,y-6);
      });

      [...new Set(det.boxes.map(b=>b.label))].forEach(lbl=>{
        const item=document.createElement('span');
        item.className='item';
        item.innerHTML=`<span class="color-dot" style="background:${colorForLabel(lbl)}"></span><strong>${lbl}</strong>`;
        legend.appendChild(item);
      });
    }

    fileInput.addEventListener('change',e=>{
      const f=e.target.files[0];
      if(!f)return;
      if(!f.type.startsWith('image/'))return alert('Select an image!');
      const r=new FileReader();
      r.onload=ev=>{
        previewImg.src=ev.target.result;
        previewImg.style.display='block';
        noImageText.style.display='none';
        loadedImage=new Image();
        loadedImage.onload=()=>{
          fitCanvas(loadedImage);
          ctx.drawImage(loadedImage,0,0,canvas.width,canvas.height);
          startBtn.disabled=false;
          statusText.textContent='Image ready.';
        };
        loadedImage.src=ev.target.result;
      };
      r.readAsDataURL(f);
    });

    resetBtn.addEventListener('click',()=>{
      fileInput.value='';
      previewImg.style.display='none';
      noImageText.style.display='block';
      progressBar.style.width='0%';
      captionArea.textContent='Caption will appear here.';
      numObjectsChip.textContent='Objects: 0';
      confidenceAvgChip.textContent='Avg Conf: —';
      ctx.clearRect(0,0,canvas.width,canvas.height);
      startBtn.disabled=true;
      ttsBtn.disabled=true;
      downloadBtn.disabled=true;
      legend.innerHTML='';
      statusText.textContent='Waiting for image...';
    });

    startBtn.addEventListener('click',async()=>{
      if(!loadedImage)return;
      statusText.textContent='Uploading image...';
      progressBar.style.width='40%';

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append('image', file);

      try {
        const resp = await fetch('/api/detect', { method: 'POST', body: formData });
        const result = await resp.json();

        currentDetections = result;
        drawDetections(loadedImage, currentDetections);

        progressBar.style.width='100%';
        statusText.textContent='Detection complete.';
        numObjectsChip.textContent=`Objects: ${currentDetections.boxes.length}`;
        confidenceAvgChip.textContent=`Avg Conf: ${(currentDetections.boxes.reduce((s,b)=>s+b.score,0)/currentDetections.boxes.length*100).toFixed(1)}%`;
        captionArea.textContent=currentDetections.caption;
        ttsBtn.disabled=false;
        downloadBtn.disabled=false;

      } catch (err) {
        console.error(err);
        statusText.textContent='Error connecting to backend.';
      }
    });

    ttsBtn.addEventListener('click',()=>{
      if(!currentDetections)return;
      const u=new SpeechSynthesisUtterance(currentDetections.caption);
      u.lang='en-US';u.rate=1;window.speechSynthesis.speak(u);
    });

    downloadBtn.addEventListener('click',()=>{
      const a=document.createElement('a');
      a.download='result.png';
      a.href=canvas.toDataURL();
      a.click();
    });
  </script>
</body>
</html>
